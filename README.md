# Локальная среда разработки

## Компоненты

#### Реверс-прокси

В качестве реверс-прокси используется Traefik + ACME сервер step-ca для получения
сертификатов. Реверс-прокси принимает все запросы и отправляет их в нужные контейнеры.

Он используется для упрощения настройки, так как Traefik может самостоятельно обнаруживать
нужные контейнеры и правила роутинга, через лейблы докер контейнера, в который нужно
отправлять запрос, а так же получать сертификаты для этих доменов.

#### Базы данных

В среде присутствуют 3 базы данных: MariaDB, Postgres и Redis. У MariaDB и Postgres
открыты порты по умолчанию, чтобы к ним можно было подключиться через сторонние
клиенты, например IDE.

#### Minio

S3 сервер. Используется для разработки сайтов, которые будут использовать
хранилище S3.

#### RabbitMQ

Брокер очередей. Используется, когда Redis недостаточно.

#### Images

Dockerfile'ы и конфиги для образов, которые используются в этом репозитории.

#### Templates

Шаблоны для разворачивания бэкенда и фронтенда.

#### Dip

Конфигурация для [Dip](https://github.com/bibendi/dip). Используется для взаимодействия
со всеми программами в среде без прописывания `docker exec -it ...` вручную.

#### Utils

Конфигурация программ, которые нужно запускать внутри контейнеров через Dip.

## Установка

1. Склонировать репозиторий.
2. Установить `make` и [dip](https://github.com/bibendi/dip).
3. Указать переменную `ENVIRONMENT_DIR` в файле `dip.yml`.
4. Запустить `make` в корне проекта.
5. Установить сертификат `reverse-proxy/ca/certs/root_ca.crt`.

Если нужно поменять пароли, перед запуском `make` необходимо прописать желаемые
значения в `.env` в папках `databases`, `minio`, `rabbitmq` и `reverse-proxy`.
Если этого не сделать, все контейнеры инициализируются с паролем `password`.

Способ установки сертификата зависит от операционной системы и программы, которая
используется для входа на сайт. Программы не всегда доверяют системным сертификатам,
поэтому нужно найти в настройках способ добавить сертификат в их собственное хранилище.
